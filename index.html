<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <title>Registro de Criptomonedas</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #1f1f2e, #3a3a5c);
            color: #e1e1ff;
            padding: 18px;
            overflow-x: hidden;
        }
        .container {
            margin-top: 20px;
            background: rgba(50, 50, 80, 0.9);
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            padding: 20px;
        }
        h2, h3 {
            text-align: center;
            font-size: 0.8rem;
            color: #00e0ff;
            text-shadow: 0 0 10px #00e0ff;
        }
        .form-group label {
            font-size: 0.8rem;
            color: #e1e1ff;
        }
        .form-group input, .form-group select {
            font-size: 0.8rem;
            padding: 7px;
            border: 1px solid #00e0ff;
            background: rgba(30, 30, 50, 0.8);
            color: #e1e1ff;
            border-radius: 5px;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #ff00ff;
            box-shadow: 0 0 10px #ff00ff;
        }
        .btn {
            font-size: 1rem;
            width: 100%;
            margin-bottom: 10px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(135deg, #00e0ff, #ff00ff);
            color: #1f1f2e;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            transition: transform 0.2s ease-in-out;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.8);
        }
        table {
            margin-top: 20px;
            font-size: 0.8rem;
            background: rgba(243, 243, 243, 0.9);
            border-radius: 10px;
            overflow: hidden;
            color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }
        th, td {
            text-align: center;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        th {
            background: rgba(182, 204, 218, 0.9);
            color: #0059ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        tr:nth-child(even) {
            background: rgba(202, 216, 79, 0.9);
        }
        .total-gain {
            font-size: 1.1rem;
            font-weight: bold;
            margin: 20px 0;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
            text-align: center;
        }
        .sell-options {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }
        .sell-options button {
            font-size: 1rem;
            flex: 1;
            margin: 0 5px;
            background: rgba(30, 30, 50, 0.9);
            color: #00e0ff;
            border: 1px solid #00e0ff;
        }
        .sell-options button:hover {
            background: #00e0ff;
            color: #1f1f2e;
        }
        @media (max-width: 768px) {
            h2 {
                font-size: 1.5rem;
            }
            .form-group input, .form-group select, .btn {
                font-size: 1rem;
                padding: 8px;
            }
            table {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Registro de Compras y Ventas de Criptomonedas</h2>

        <!-- Formulario de Compra -->
        <div class="form-group">
            <label for="cryptoSelect">Selecciona una Criptomoneda:</label>
            <select id="cryptoSelect" class="form-control">
                <option value="SOL">SOL</option>
                <option value="BTC">BTC</option>
                <option value="ETH">ETH</option>
                <option value="FTM">FTM</option>
                <option value="XRP">XRP</option>
                <option value="ADA">ADA</option>
                <option value="DOGE">DOGE</option>
                <option value="BNB">BNB</option>
                <option value="PEPE">PEPE</option>
                <option value="SHIBA">SHIBA</option>
                <option value="SUI">SUI</option>
                <option value="RAY">RAY</option>
                <option value="TETHA">THETA</option>
                <option value="HBAR">HBAR</option>
            </select>
        </div>
        <div class="form-group">
            <label for="buyPrice">Precio de Compra:</label>
            <input type="number" id="buyPrice" class="form-control" placeholder="Precio de compra" required min="0.01" step="0.01">
        </div>
        <div class="form-group">
            <label for="buyAmount">Cantidad:</label>
            <input type="number" id="buyAmount" class="form-control" placeholder="Cantidad" required min="0.01" step="0.01">
        </div>
        <button id="buyButton" class="btn">Registrar Compra</button>

        <!-- Formulario de Venta -->
        <div class="form-group">
            <label for="sellSelect">Selecciona una Criptomoneda para Vender:</label>
            <select id="sellSelect" class="form-control"></select>
        </div>
        <div class="form-group">
            <label for="sellPrice">Precio de Venta:</label>
            <input type="number" id="sellPrice" class="form-control" placeholder="Precio de venta" required min="0.01" step="0.01">
        </div>
        <div class="form-group">
            <label for="sellAmount">Cantidad a Vender:</label>
            <input type="number" id="sellAmount" class="form-control" placeholder="Cantidad a vender" required min="0.01" step="0.01">
        </div>
        <div class="sell-options">
            <button class="btn" onclick="setSellPercentage(5)">5%</button>
            <button class="btn" onclick="setSellPercentage(10)">10%</button>
            <button class="btn" onclick="setSellPercentage(25)">25%</button>
            <button class="btn" onclick="setSellPercentage(50)">50%</button>
            <button class="btn" onclick="setSellPercentage(100)">100%</button>
        </div>
        <button id="sellButton" class="btn">Registrar Venta</button>

        <!-- Ganancias Totales -->
        <div class="total-gain" id="totalGain">Ganancias Totales: $0</div>

        <!-- Historial de Compras -->
        <h3>Historial de Compras</h3>
        <table class="table table-bordered table-responsive-sm" id="purchaseTable">
            <thead>
                <tr>
                    <th>Cripto</th>
                    <th>Precio de Compra</th>
                    <th>Cantidad</th>
                    <th>Fecha</th>
                </tr>
            </thead>
            <tbody id="purchaseBody"></tbody>
        </table>

        <!-- Historial de Ventas -->
        <h3>Historial de Ventas</h3>
        <table class="table table-bordered table-responsive-sm" id="salesTable">
            <thead>
                <tr>
                    <th>Cripto</th>
                    <th>Precio de Venta</th>
                    <th>Cantidad</th>
                    <th>Ganancia</th>
                    <th>Fecha</th>
                </tr>
            </thead>
            <tbody id="salesBody"></tbody>
        </table>

        <!-- Backup y Restauración -->
        <button id="backupButton" class="btn">Backup</button>
        <button id="restoreButton" class="btn">Restaurar</button>
        <button id="resetButton" class="btn">Reiniciar Base de Datos</button>
    </div>

    <script>
        const db = localStorage;

        const clearFields = () => {
            document.getElementById('buyPrice').value = '';
            document.getElementById('buyAmount').value = '';
            document.getElementById('sellPrice').value = '';
            document.getElementById('sellAmount').value = '';
        };

        const updateTables = () => {
            const purchases = JSON.parse(db.getItem('purchases') || '[]');
            const purchaseBody = document.getElementById('purchaseBody');
            purchaseBody.innerHTML = '';
            purchases.forEach(purchase => {
                const row = `<tr>
                    <td>${purchase.crypto}</td>
                    <td>$${purchase.price.toFixed(2)}</td>
                    <td>${purchase.amount}</td>
                    <td>${new Date(purchase.date).toLocaleString()}</td>
                </tr>`;
                purchaseBody.innerHTML += row;
            });

            const sales = JSON.parse(db.getItem('sales') || '[]');
            const salesBody = document.getElementById('salesBody');
            salesBody.innerHTML = '';
            let totalGain = 0;
            sales.forEach(sale => {
                totalGain += sale.gain;
                const row = `<tr>
                    <td>${sale.crypto}</td>
                    <td>$${sale.price.toFixed(2)}</td>
                    <td>${sale.amount}</td>
                    <td>$${sale.gain.toFixed(2)}</td>
                    <td>${new Date(sale.date).toLocaleString()}</td>
                </tr>`;
                salesBody.innerHTML += row;
            });

            document.getElementById('totalGain').innerText = `Ganancias Totales: $${totalGain.toFixed(2)}`;

            const sellSelect = document.getElementById('sellSelect');
            sellSelect.innerHTML = '';
            const uniqueCryptos = purchases.reduce((acc, p) => {
                acc[p.crypto] = (acc[p.crypto] || 0) + p.amount;
                return acc;
            }, {});
            Object.entries(uniqueCryptos).forEach(([crypto, amount]) => {
                const option = `<option value="${crypto}">${crypto} (${amount.toFixed(2)})</option>`;
                sellSelect.innerHTML += option;
            });
        };

        const setSellPercentage = (percentage) => {
            const sellSelect = document.getElementById('sellSelect');
            const crypto = sellSelect.value;
            const purchases = JSON.parse(db.getItem('purchases') || '[]');
            const totalCrypto = purchases.filter(p => p.crypto === crypto).reduce((sum, p) => sum + p.amount, 0);
            const amountToSell = (totalCrypto * percentage) / 100;
            document.getElementById('sellAmount').value = amountToSell.toFixed(2);
        };

        document.getElementById('buyButton').addEventListener('click', () => {
            const crypto = document.getElementById('cryptoSelect').value;
            const price = parseFloat(document.getElementById('buyPrice').value);
            const amount = parseFloat(document.getElementById('buyAmount').value);

            if (!isNaN(price) && price > 0 && !isNaN(amount) && amount > 0) {
                const purchases = JSON.parse(db.getItem('purchases') || '[]');
                purchases.push({ crypto, price, amount, date: new Date() });
                db.setItem('purchases', JSON.stringify(purchases));
                alert('Compra registrada con éxito');
                clearFields();
                updateTables();
            } else {
                alert('Por favor, ingresa valores válidos para la compra.');
            }
        });

        document.getElementById('sellButton').addEventListener('click', () => {
            const crypto = document.getElementById('sellSelect').value;
            const price = parseFloat(document.getElementById('sellPrice').value);
            const amount = parseFloat(document.getElementById('sellAmount').value);

            if (!isNaN(price) && price > 0 && !isNaN(amount) && amount > 0) {
                const purchases = JSON.parse(db.getItem('purchases') || '[]');
                const totalCrypto = purchases.filter(p => p.crypto === crypto).reduce((sum, p) => sum + p.amount, 0);

                if (amount <= totalCrypto) {
                    const remainingPurchases = [];
                    let remainingAmount = amount;

                    purchases.forEach(purchase => {
                        if (purchase.crypto === crypto && remainingAmount > 0) {
                            const usedAmount = Math.min(remainingAmount, purchase.amount);
                            purchase.amount -= usedAmount;
                            remainingAmount -= usedAmount;

                            if (purchase.amount > 0) {
                                remainingPurchases.push(purchase);
                            }
                        } else {
                            remainingPurchases.push(purchase);
                        }
                    });

                    db.setItem('purchases', JSON.stringify(remainingPurchases));

                    const gain = (price - purchases.find(p => p.crypto === crypto).price) * amount;

                    const sales = JSON.parse(db.getItem('sales') || '[]');
                    sales.push({ crypto, price, amount, gain, date: new Date() });
                    db.setItem('sales', JSON.stringify(sales));

                    alert('Venta registrada con éxito');
                    clearFields();
                    updateTables();
                } else {
                    alert('No tienes suficiente cantidad para vender.');
                }
            } else {
                alert('Por favor, ingresa valores válidos para la venta.');
            }
        });

        document.getElementById('backupButton').addEventListener('click', () => {
            const backupData = {
                purchases: JSON.parse(db.getItem('purchases') || '[]'),
                sales: JSON.parse(db.getItem('sales') || '[]')
            };
            const backupBlob = new Blob([JSON.stringify(backupData)], { type: 'application/json' });
            const backupLink = document.createElement('a');
            backupLink.href = URL.createObjectURL(backupBlob);
            backupLink.download = 'backup.json';
            backupLink.click();
        });

        document.getElementById('restoreButton').addEventListener('click', () => {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.json';
            fileInput.click();

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.readAsText(file);

                reader.onload = () => {
                    const restoredData = JSON.parse(reader.result);
                    db.setItem('purchases', JSON.stringify(restoredData.purchases));
                    db.setItem('sales', JSON.stringify(restoredData.sales));
                    alert('Datos restaurados con éxito');
                    updateTables();
                };
            });
        });

        document.getElementById('resetButton').addEventListener('click', () => {
            if (confirm('¿Estás seguro de que deseas reiniciar la base de datos?')) {
                db.clear();
                alert('Base de datos reiniciada');
                updateTables();
            }
        });

        updateTables();
    </script>
</body>
</html>
